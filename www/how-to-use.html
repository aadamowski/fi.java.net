<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE>How to use Fast Infoset parsers and serializers</TITLE>
	<META NAME="GENERATOR" CONTENT="StarOffice 8  (Solaris x86)">
	<META NAME="CREATED" CONTENT="20050111;14114000">
	<META NAME="CHANGED" CONTENT="20051017;10211100">
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H3>How to use the Fast Infoset parsers and serializers</H3>
<P>The Fast Infoset project currently contains three types of
implementations for the following APIs:</P>
<OL>
	<LI><P>SAX, implementing the <A HREF="http://java.sun.com/j2se/1.5.0/docs/api/org/xml/sax/ContentHandler.html">ContentHandler</A>
	interface.</P>
</OL>
<UL>
	<UL>
		<LI><P>Parser impl: <A HREF="https://fi.dev.java.net/source/browse/fi/FastInfoset/src/com/sun/xml/fastinfoset/sax/SAXDocumentParser.java?only_with_tag=HEAD&amp;view=markup">com.sun.xml.fastinfoset.sax.SAXDocumentParser</A></P>
		<LI><P>Serializer impl:
		<A HREF="https://fi.dev.java.net/source/browse/fi/FastInfoset/src/com/sun/xml/fastinfoset/sax/SAXDocumentSerializer.java?only_with_tag=HEAD&amp;view=markup">com.sun.xml.fastinfoset.sax.SAXDocumentSerializer</A></P>
	</UL>
</UL>
<OL START=2>
	<LI><P>StAX, implementing the <A HREF="https://stax-utils.dev.java.net/nonav/javadoc/api/javax/xml/stream/XMLStreamReader.html">XMLStreamReader</A>
	and <A HREF="https://stax-utils.dev.java.net/nonav/javadoc/api/javax/xml/stream/XMLStreamWriter.html">XMLStreamWriter</A>
	interfaces.</P>
</OL>
<UL>
	<UL>
		<LI><P>Parser impl: <A HREF="https://fi.dev.java.net/source/browse/fi/FastInfoset/src/com/sun/xml/fastinfoset/stax/StAXDocumentParser.java?view=markup">com.sun.xml.fastinfoset.stax.StAXDocumentParser</A></P>
		<LI><P>Serializer impl:
		<A HREF="https://fi.dev.java.net/source/browse/fi/FastInfoset/src/com/sun/xml/fastinfoset/stax/StAXDocumentSerializer.java?view=markup">com.sun.xml.fastinfoset.stax.StAXDocumentSerializer</A></P>
	</UL>
</UL>
<OL START=3>
	<LI><P>DOM, using the a conformant <A HREF="http://java.sun.com/j2se/1.5.0/docs/api/org/w3c/dom/package-summary.html">DOM</A>
	implementation to construct or serialize a Document.</P>
</OL>
<UL>
	<UL>
		<LI><P>Parser impl: <A HREF="https://fi.dev.java.net/source/browse/fi/FastInfoset/src/com/sun/xml/fastinfoset/dom/DOMDocumentParser.java?view=markup">com.sun.xml.fastinfoset.dom.DOMDocumentParser</A></P>
		<LI><P>Serializer impl:
		<A HREF="https://fi.dev.java.net/source/browse/fi/FastInfoset/src/com/sun/xml/fastinfoset/dom/DOMDocumentSerializer.java?view=markup">com.sun.xml.fastinfoset.dom.DOMDocumentSerializer</A></P>
	</UL>
</UL>
<P>There are no factory based mechanisms for instantiating the
parsers and serializers, as is the case JAXP. It is necessary to
instantiate the concrete classes (presented above) directly.</P>
<H3>Using the Fast Infoset SAX parser and serializer</H3>
<P>The following code shows how to parse a fast infoset document:</P>
<PRE>import java.io.*;
import org.xml.sax.*;
import com.sun.xml.fastinfoset.sax.*;

// Instantiate the FI SAX parser
XMLReader saxReader = new SAXDocumentParser();

// Set the content handler
ContentHandler ch = ...
saxReader.setContentHandler(ch);
// Parse the fast infoset document
InputStream in = new BufferedInputStream(new FileInputStream(&lt;fast infoset document&gt;));
saxReader.parse(new InputSource(in));</PRE><P>
<BR><BR>
</P>
<P>The following code shows how to translate an XML document to a
fast infoset document using the Fast Infoset SAX serializer:</P>
<PRE>import java.io.*;
import javax.xml.parsers.*;
import com.sun.xml.fastinfoset.sax.*;

// Get the input stream for the XML document
InputStream xmlDocument = ...
// Set up output stream for fast infoset document
OutputStream fiDocument = ...

// Create Fast Infoset SAX serializer
SAXDocumentSerializer saxDocumentSerializer = new SAXDocumentSerializer();
// Set the output stream
saxDocumentSerializer.setOutputStream(fiDocument);

// Instantiate JAXP SAX parser factory
<A NAME="DDE_LINK5"></A>SAXParserFactory saxParserFactory = SAXParserFactory.newInstance();
/* Set parser to be namespace aware
 * Very important to do otherwise invalid FI documents will be
 * created by the SAXDocumentSerializer
 */
saxParserFactory.setNamespaceAware(true);
// Instantiate the JAXP SAX parser
SAXParser saxParser = saxParserFactory.newSAXParser();
// Set the lexical handler
saxParser.setProperty(&quot;http://xml.org/sax/properties/lexical-handler&quot;, documentSerializer);
// Parse the XML document and convert to a fast infoset document
saxParser.parse(xmlDocument, documentSerializer);</PRE><P>
<BR><BR>
</P>
<P>The following code shows how to translate a fast infoset document
to an XML document using a FastInfosetSource and a StreamResult:</P>
<PRE>import java.io.*;
import javax.xml.transform.*;
import javax.xml.transform.stream.*;
import org.jvnet.fastinfoset.*;

// Get the input stream for the fast infoset document
InputStream fiDocument = ...
// Set up output stream for XML document
OutputStream xmlDocument = ...

// Create the transformer
Transformer tx = TransformerFactory.newInstance().newTransformer();
// Transform to convert the FI document to an XML document
tx.transform(new FastInfosetSource(fiDocument), new StreamResult(xmlDocument));</PRE><H3>
Using the Fast Infoset StAX parser and serializer</H3>
<P>The following code shows how to parse a fast infoset document</P>
<PRE>import java.io.*;
import javax.xml.stream.*;
import com.sun.xml.fastinfoset.stax.*;

// Get the input stream for the fast infoset document
InputStream fiDocument = ...

<A NAME="DDE_LINK3"></A>// Create the StAX XMLStreamReader using the input stream
XMLStreamReader streamReader = new StAXDocumentParser(fiDocument);</PRE><P>
<BR><BR>
</P>
<P>The following code shows how to serialize to a fast infoset
document:</P>
<PRE>import javax.xml.stream.*;
import com.sun.xml.fastinfoset.stax.*;

// Set up output stream for fast infoset document
OutputStream fiDocument = ...

// Create the StAX document serializer
StAXDocumentSerializer staxDocumentSerializer = new StAXDocumentSerializer();
staxDocumentSerializer.setOutputStream(fiDocument);

// Obtain XMLStreamWriter interface
XMLStreamWriter streamWriter = staxDocumentSerializer;

// Write out some simple infoset
<A NAME="DDE_LINK1"></A><A NAME="DDE_LINK2"></A>streamWriter.writeStartDocument();
   streamWriter.writeStartElement(&ldquo;foo&rdquo;);
      streamWriter.writeCharacters(&ldquo;bar&rdquo;);
   streamWriter.writeEndElement();
streamWriter.writeEndDocument();
streamWriter.close();</PRE><H3>
Using the Fast Infoset StAX parser and serializer with JAXB</H3>
<P>The following code shows how to unmarshall a fast infoset document
using the FI StAX parser to an Object: 
</P>
<PRE>import java.io.*;
import javax.xml.bind.*;
import javax.xml.stream.*;
import com.sun.xml.fastinfoset.stax.*;

// Get the input stream for the fast infoset document
InputStream fiDocument = ...

// Create the StAX XMLStreamReader using the input stream
XMLStreamReader streamReader = new StAXDocumentParser(fiDocument);

// Create JAXB context
JAXBContext context = JAXBContext.newInstance(...);

// Create unmarshaller
Unmarshaller u = context.createUnmarshaller();
// Unmarshall from the stream to an object
Object jaxbObject = u.unmarshal(streamReader);</PRE><P>
<BR><BR>
</P>
<P>The following code shows how to marshall an Object using the FI
StAX serializer to a fast infoset document:</P>
<PRE>import java.io.*;
import javax.xml.bind.*;
import javax.xml.stream.*;
import com.sun.xml.fastinfoset.stax.*;

// Set up output stream for fast infoset document
OutputStream fiDocument = ...

// Create the StAX document serializer
StAXDocumentSerializer staxDocumentSerializer = new StAXDocumentSerializer();
staxDocumentSerializer.setOutputStream(fiDocument);

// Obtain XMLStreamWriter interface
<A NAME="DDE_LINK4"></A>XMLStreamWriter streamWriter = staxDocumentSerializer;

// Create JAXB context
JAXBContext context = JAXBContext.newInstance(...);

// Create the marshaller
Marshaller m = context.createMarshaller();
// Marshall the object to the stream
m.marshal(jaxbObject, streamWriter);</PRE><P>
<BR><BR>
</P>
<P>When using the StAX parsers and serializers with the JAXB 2.0
java.net implementation there is an optimization to support the
efficient marshalling and unmarshalling of byte[] that represents an
xsd:base64Binary datatype for element content. When marshalling to
XML documents such objects would be encoded to a string of characters
that is the base64 encoding of the bytes. When marshalling to fast
infoset documents using the FI StAX serializer such objects will be
encoded as a sequence of octets that are the bytes of the object.
When unmarshalling such octets will be directly assigned to the
object. Thus no base64 encoding and decoding is required. This
increases performance and reduces the size of fast infoset documents.</P>
</BODY>
</HTML>